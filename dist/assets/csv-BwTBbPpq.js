import{i as k,c as q,g as P,p as V,t as c,d as E,h as j,u as F,s as U,r as A,_ as D,a as N}from"./index-CM0taMZN.js";function Y(){const o=[["Name","SKU","UPC","Category","Subcategory","Source","Condition","Platforms","Qty","Cost","Price","Fees","Ship","Margin","Notes","Added","ISBN","Author","Publisher","Edition","Printing","Year","Signed","Sales Rank"]];for(const e of k){const{m:i}=q(e);o.push([e.name,e.sku||"",e.upc||"",e.category||"",e.subcategory||"",e.source||"",e.condition||"",P(e).join(";"),e.qty,e.cost,e.price,e.fees||0,e.ship||0,V(i),e.notes||"",e.added||"",e.isbn||"",e.author||"",e.publisher||"",e.edition||"",e.printing||"",e.pubYear||"",e.signed?"Yes":"",e.salesRank||""])}const f=o.map(e=>e.map(i=>`"${String(i).replace(/"/g,'""')}"`).join(",")).join(`
`),r=document.createElement("a");r.href="data:text/csv;charset=utf-8,"+encodeURIComponent(f),r.download="fliptrack-inventory.csv",r.click(),c("Inventory CSV exported ✓")}function O(){const o=[["Date","Item Name","SKU","Platform","Qty","Sale Price","List Price","Fees","Shipping","Profit"]];for(const e of j){const i=k.find(u=>u.id===e.itemId),p=(e.price||0)*(e.qty||0)-(i?(i.cost||0)*(e.qty||0):0)-(e.fees||0)-(e.ship||0);o.push([e.date,i?i.name:"Deleted Item",i?i.sku:"",e.platform||"",e.qty,e.price,e.listPrice||"",e.fees||0,e.ship||0,p.toFixed(2)])}const f=o.map(e=>e.map(i=>`"${String(i).replace(/"/g,'""')}"`).join(",")).join(`
`),r=document.createElement("a");r.href="data:text/csv;charset=utf-8,"+encodeURIComponent(f),r.download="fliptrack-sales.csv",r.click(),c("Sales CSV exported ✓")}function B(){const o=[["Date","Category","Description","Amount"]];for(const e of E)o.push([e.date,e.category,e.description,e.amount]);const f=o.map(e=>e.map(i=>`"${String(i).replace(/"/g,'""')}"`).join(",")).join(`
`),r=document.createElement("a");r.href="data:text/csv;charset=utf-8,"+encodeURIComponent(f),r.download="fliptrack-expenses.csv",r.click(),c("Expenses CSV exported ✓")}function T(){Y(),setTimeout(()=>O(),300),setTimeout(()=>B(),600)}function z(o){if(!o)return;if(o.size>5*1024*1024){c("CSV too large (max 5MB)",!0);return}const f=new FileReader;f.onload=function(r){try{const e=r.target.result,i=e.indexOf("	")!==-1&&e.indexOf(",")===-1?"	":",",p=[];let u="",y=!1;for(let s=0;s<e.length;s++){const n=e[s];n==='"'?(y=!y,u+=n):(n===`
`||n==="\r")&&!y?(u.trim()&&p.push(u),u="",n==="\r"&&e[s+1]===`
`&&s++):u+=n}if(u.trim()&&p.push(u),p.length<2){c("CSV appears empty",!0);return}const S=s=>{const n=[];let a="",d=!1;for(let m=0;m<s.length;m++){const g=s[m];g==='"'?d&&s[m+1]==='"'?(a+='"',m++):d=!d:g===i&&!d?(n.push(a.trim()),a=""):a+=g}return n.push(a.trim()),n},I=S(p[0]).map(s=>s.toLowerCase().replace(/[^a-z0-9]/g,"")),t={},v={name:["name","title","itemname","item","productname","product"],sku:["sku","itemsku","productsku"],upc:["upc","barcode","ean","gtin"],category:["category","cat","type","department"],subcategory:["subcategory","subcat","subcategory"],source:["source","sourcedfrom","wherebought","store"],condition:["condition","cond","itemcondition"],platform:["platform","platforms","marketplace","channel"],qty:["qty","quantity","stock","units","qtyavailable"],cost:["cost","costprice","purchaseprice","cogs","buyprice","pricepaid"],price:["price","listprice","sellingprice","askingprice","listingprice","saleprice"],fees:["fees","platformfees","sellingfees"],ship:["ship","shipping","shippingcost"],notes:["notes","description","comments","memo"],isbn:["isbn","isbn10","isbn13","isbnno"],author:["author","authors","writer","by"],publisher:["publisher","pub","publishedby"],edition:["edition","ed"],printing:["printing","print","printrun"],pubYear:["year","yearpublished","pubyear","publishyear","publicationyear"],signed:["signed","autographed","signature"],salesRank:["salesrank","amazonrank","rank","bsr"]};for(const[s,n]of Object.entries(v)){const a=I.findIndex(d=>n.includes(d));a!==-1&&(t[s]=a)}if(t.name===void 0){c('CSV needs a "Name" column',!0);return}if(p.length-1>1e4){c("Too many rows (max 10,000)",!0);return}let h=0,b=0;for(let s=1;s<p.length;s++){const n=S(p[s]),a=(n[t.name]||"").trim();if(!a){b++;continue}const d=t.category!==void 0?(n[t.category]||"").trim():"",m=new Date().toISOString().slice(0,10).replace(/-/g,""),g=(d||"GEN").toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,4).padEnd(3,"X"),x=Math.random().toString(36).slice(2,5).toUpperCase(),C=t.platform!==void 0?(n[t.platform]||"").trim():"",w=C?C.split(/[;,|]/).map(R=>R.trim()).filter(Boolean):[],l={id:F(),name:a,sku:t.sku!==void 0&&(n[t.sku]||"").trim()||g+"-"+m+"-"+x,upc:t.upc!==void 0?(n[t.upc]||"").trim():"",category:d,subcategory:t.subcategory!==void 0?(n[t.subcategory]||"").trim():"",subtype:"",platform:w[0]||"Other",platforms:w,cost:t.cost!==void 0&&parseFloat(n[t.cost])||0,price:t.price!==void 0&&parseFloat(n[t.price])||0,qty:t.qty!==void 0&&parseInt(n[t.qty])||1,bulk:!1,fees:t.fees!==void 0&&parseFloat(n[t.fees])||0,ship:t.ship!==void 0&&parseFloat(n[t.ship])||0,lowAlert:2,notes:t.notes!==void 0?(n[t.notes]||"").trim():"",source:t.source!==void 0?(n[t.source]||"").trim():"",condition:t.condition!==void 0?(n[t.condition]||"").trim():"",images:[],image:null,added:new Date().toISOString()};t.isbn!==void 0&&(l.isbn=(n[t.isbn]||"").trim()),t.author!==void 0&&(l.author=(n[t.author]||"").trim()),t.publisher!==void 0&&(l.publisher=(n[t.publisher]||"").trim()),t.edition!==void 0&&(l.edition=(n[t.edition]||"").trim()),t.printing!==void 0&&(l.printing=(n[t.printing]||"").trim()),t.pubYear!==void 0&&(l.pubYear=parseInt(n[t.pubYear])||null),t.signed!==void 0&&(l.signed=["yes","true","1","y"].includes((n[t.signed]||"").trim().toLowerCase())),t.salesRank!==void 0&&(l.salesRank=parseInt(n[t.salesRank])||null),k.push(l),h++}if(!h){c("No valid rows found",!0);return}U(),A(),D.create(),c(h+" item"+(h!==1?"s":"")+" imported ✓"+(b?" ("+b+" skipped)":"")),N()}catch(e){c("Import error: "+(e.message||"unknown"),!0)}document.getElementById("csvImportInput").value=""},f.readAsText(o)}export{T as exportAll,Y as exportCSV,B as exportExpensesCSV,O as exportSalesCSV,z as importCSV};
