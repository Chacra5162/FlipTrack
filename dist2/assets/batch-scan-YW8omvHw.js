let r=null,l=!1,o=[],u=new Set,m=null;async function v(){o=[],u.clear(),document.getElementById("batchOv").classList.add("on"),document.getElementById("batchSource").value="",h();try{r=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});const t=document.getElementById("batchVideo");t.srcObject=r,await t.play(),l=!0,document.getElementById("batchScanStatus").textContent="Point camera at barcodes…","BarcodeDetector"in window?b(t):await _ensureQuagga()?y(t):document.getElementById("batchScanStatus").textContent="Camera ready — use + Manual to add items"}catch{document.getElementById("batchScanStatus").textContent="Camera unavailable — use + Manual to add items"}}function f(){l=!1,m&&cancelAnimationFrame(m),r&&(r.getTracks().forEach(t=>t.stop()),r=null),document.getElementById("batchOv").classList.remove("on")}function b(t){let e;try{e=new BarcodeDetector({formats:["ean_13","ean_8","upc_a","upc_e","code_128","code_39","itf"]})}catch{e=new BarcodeDetector}const n=document.createElement("canvas"),i=n.getContext("2d");function c(){l&&(t.readyState>=2&&(n.width=t.videoWidth,n.height=t.videoHeight,i.drawImage(t,0,0),e.detect(n).then(s=>{for(const a of s){const d=a.rawValue.trim();d&&!u.has(d)&&(u.add(d),p(d))}}).catch(()=>{})),m=requestAnimationFrame(c))}c()}function y(t){const e=document.createElement("canvas"),n=e.getContext("2d");function i(){l&&(t.readyState>=2&&(e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0),n.getImageData(0,0,e.width,e.height),Quagga.decodeSingle({decoder:{readers:["ean_reader","upc_reader","upc_e_reader","code_128_reader"]},locate:!0,src:e.toDataURL("image/jpeg",.8)},c=>{if(c&&c.codeResult){const s=c.codeResult.code.trim();s&&!u.has(s)&&(u.add(s),p(s))}})),setTimeout(()=>{l&&(m=requestAnimationFrame(i))},500))}i()}function p(t){const e=inv.find(n=>n.upc===t);o.push({id:uid(),upc:t,name:e?e.name:"",cost:e?e.cost:0,price:e?e.price:0,category:e&&e.category||"",isExisting:!!e}),_sfx.create(),document.getElementById("batchScanStatus").textContent="Scanned: "+t+" ✓",h()}function S(){o.push({id:uid(),upc:"",name:"",cost:0,price:0,category:"",isExisting:!1}),h(),setTimeout(()=>{const t=document.querySelectorAll("#batchList .batch-name-input");t.length&&t[t.length-1].focus()},50)}function I(t){o=o.filter(e=>e.id!==t),h()}function h(){const t=document.getElementById("batchList"),e=document.getElementById("batchEmpty"),n=document.getElementById("batchCount"),i=document.getElementById("batchAddBtn");if(n.textContent=o.length+" item"+(o.length!==1?"s":""),i.disabled=!o.length,!o.length){e.style.display="",t.querySelectorAll(".batch-item").forEach(a=>a.remove());return}e.style.display="none";const c=o.map((a,d)=>`<div class="batch-item" data-batch-id="${a.id}">
    <div style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;width:20px;text-align:center">${d+1}</div>
    <div class="batch-item-info">
      <input class="batch-name-input" type="text" value="${escHtml(a.name)}" placeholder="Item name *"
        oninput="_batchItems.find(i=>i.id==='${a.id}').name=this.value"
        style="background:none;border:none;border-bottom:1px solid var(--border);color:var(--text);font-size:12px;font-weight:600;width:100%;padding:3px 0;font-family:inherit">
      <div class="batch-item-upc">${a.upc?a.upc:"No barcode"}${a.isExisting?' · <span style="color:var(--accent)">found in inventory</span>':""}</div>
    </div>
    <div class="batch-item-fields">
      <input type="number" placeholder="Cost" value="${a.cost||""}" step="0.01"
        oninput="_batchItems.find(i=>i.id==='${a.id}').cost=parseFloat(this.value)||0">
      <input type="number" placeholder="Price" value="${a.price||""}" step="0.01"
        oninput="_batchItems.find(i=>i.id==='${a.id}').price=parseFloat(this.value)||0">
    </div>
    <button class="batch-item-rm" onclick="batchRemoveItem('${a.id}')">×</button>
  </div>`).join("");t.querySelectorAll(".batch-item").forEach(a=>a.remove()),e.insertAdjacentHTML("afterend",c)}function x(){const t=document.getElementById("batchSource").value.trim();let e=0;for(const n of o){const i=n.name.trim();if(!i)continue;const c=n.category||"",s=new Date().toISOString().slice(0,10).replace(/-/g,""),a=(c||"GEN").toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,4).padEnd(3,"X"),d=Math.random().toString(36).slice(2,5).toUpperCase(),g=a+"-"+s+"-"+d;inv.push({id:uid(),name:i,sku:g,upc:n.upc||"",category:c,subcategory:"",subtype:"",platform:"Other",platforms:[],cost:n.cost||0,price:n.price||0,qty:1,bulk:!1,fees:0,ship:0,lowAlert:2,notes:t?"Batch scanned from "+t:"Batch scanned",source:t,images:[],image:null,added:new Date().toISOString()}),e++}if(!e){toast("No items with names to add",!0);return}save(),refresh(),_sfx.create(),toast(e+" item"+(e!==1?"s":"")+" added to inventory ✓"),f(),autoSync()}export{b as _runBatchDetector,y as _runBatchQuagga,x as batchAddAll,p as batchAddScanned,S as batchManualAdd,I as batchRemoveItem,f as closeBatchScan,v as openBatchScan,h as renderBatchList};
//# sourceMappingURL=batch-scan-YW8omvHw.js.map
